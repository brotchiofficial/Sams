<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Dashboard v16.1</title>
  <style>
    body {margin:0; font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
      background:linear-gradient(135deg,#2B2B3D,#1e1e2a); color:#f0f0f0; height:100vh; display:flex; justify-content:center; align-items:center;}
    .card {background:rgba(58,58,80,0.6); backdrop-filter:blur(12px); padding:30px; border-radius:20px; box-shadow:0 8px 30px rgba(0,0,0,0.5); text-align:center; width:420px;}
    button {padding:12px; margin:8px 0; width:90%; border:none; border-radius:10px; font-weight:bold; cursor:pointer; transition:0.3s;}
    #startService{background:#4CAF50;color:white;} #stopService{background:#dc3545;color:white;} #changePwd{background:#007BFF;color:white;} #logoutBtn{background:#6c757d;color:white;}
    .fab {position:fixed; bottom:20px; width:50px; height:50px; border-radius:50%; border:none; font-size:20px; font-weight:bold; cursor:pointer; color:white;}
    #fabLeft{left:20px; background:#007BFF;} #fabRight{right:20px; background:#4CAF50;} #fabAdmin{right:80px; background:#ff9800;}
    .overlay {display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); justify-content:center; align-items:center;}
    .overlay-content {background:rgba(58,58,80,0.9); backdrop-filter:blur(15px); padding:20px; border-radius:20px; width:600px; max-height:80%; overflow-y:auto;}
    .overlay-content h2{text-align:center;}
    .closeBtn{margin-top:10px; background:#dc3545; color:white; width:100%;}
    ul{list-style:none; padding:0;} li{background:rgba(255,255,255,0.05); margin:6px 0; padding:10px; border-radius:10px;}
  </style>
</head>
<body>
  <div class="card">
    <h1 id="welcome"></h1>
    <p id="gradeInfo"></p>
    <p>Total heures : <span id="totalHours">0</span> h</p>
    <p>Cette semaine : <span id="weeklyHours">0</span> h</p>
    <p>Timer : <span id="timer">00:00</span> <span id="statusIcon"></span></p>
    <button id="startService">Commencer</button>
    <button id="stopService">Finir</button>
    <button id="changePwd">Changer mot de passe</button>
    <button id="logoutBtn">‚¨Ö D√©connexion</button>
  </div>
  <button id="fabLeft" class="fab">üë•</button>
  <button id="fabRight" class="fab">‚ûï</button>
  <button id="fabAdmin" class="fab" style="display:none;">‚öôÔ∏è</button>

  <!-- Overlay Joueurs -->
  <div id="overlayJoueurs" class="overlay"><div class="overlay-content">
    <h2>Joueurs</h2><ul id="userList"></ul><button class="closeBtn" onclick="document.getElementById('overlayJoueurs').style.display='none'">Fermer</button>
  </div></div>

  <!-- Overlay Patients -->
  <div id="overlayPatients" class="overlay"><div class="overlay-content">
    <h2>Patients</h2>
    <button id="createPatientBtn">Cr√©er une fiche patient</button>
    <input type="text" id="searchPatient" placeholder="Rechercher...">
    <ul id="patientList"></ul>
    <button class="closeBtn" onclick="document.getElementById('overlayPatients').style.display='none'">Fermer</button>
  </div></div>

  <!-- Overlay Admin -->
  <div id="overlayAdmin" class="overlay"><div class="overlay-content">
    <h2>Panel Admin</h2>
    <table style="width:100%;color:white;"><thead><tr><th>Pseudo</th><th>Date</th><th>Grade</th><th>Action</th></tr></thead><tbody id="adminUserList"></tbody></table>
    <button class="closeBtn" onclick="document.getElementById('overlayAdmin').style.display='none'">Fermer</button>
  </div></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
    import { getFirestore, collection, onSnapshot, doc, getDoc, setDoc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDMGMkmVgl8h0WuknCA-AChlyoX95RufNs",
      authDomain: "base-de-donnee-b5c8c.firebaseapp.com",
      projectId: "base-de-donnee-b5c8c",
      storageBucket: "base-de-donnee-b5c8c.firebasestorage.app",
      messagingSenderId: "302677536354",
      appId: "1:302677536354:web:54e0d4562bad5f06c3ab3b"
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // V√©rifier utilisateur connect√©
    const savedUser = localStorage.getItem("currentUser");
    if (!savedUser) window.location.href = "index.html";
    const user = JSON.parse(savedUser);
    document.getElementById("welcome").textContent = "Bienvenue " + user.pseudo + " üéâ";
    document.getElementById("gradeInfo").textContent = "Ton grade : " + user.grade;

    // D√©connexion
    document.getElementById("logoutBtn").addEventListener("click", ()=>{
      localStorage.removeItem("currentUser");
      window.location.href="index.html";
    });

    // Fab buttons
    document.getElementById("fabLeft").addEventListener("click", ()=>{document.getElementById("overlayJoueurs").style.display="flex";});
    document.getElementById("fabRight").addEventListener("click", ()=>{document.getElementById("overlayPatients").style.display="flex";});
    if(user.grade==="admin"){document.getElementById("fabAdmin").style.display="block"; document.getElementById("fabAdmin").addEventListener("click", ()=>{document.getElementById("overlayAdmin").style.display="flex";});}

    // TODO: Ajouter logique service/timer, joueurs en temps r√©el, patients (CRUD), admin panel
  </script>
</body>
</html>